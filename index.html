<!DOCTYPE html>
<html lang="en">

<head>
     
    <meta charset="UTF-8">
      <title>Admin Panel - Upload Product</title>
</head>

<body>
      <h2>Admin Panel - Upload Product</h2>

        <div id="authSection">
            <button id="signInBtn">Sign In with Google</button>
            <button id="signOutBtn" style="display:none;">Sign Out</button>
            <p id="userEmail"></p>
          </div>

        <form id="productForm" style="display:none;">
            <input type="text" id="name" placeholder="Product Name" required><br><br>
            <input type="number" id="price" placeholder="Product Price" required><br><br>
            <input type="text" id="category" placeholder="Category (e.g., tshirt, bag)" required><br><br>
            <input type="file" id="image" required><br><br>
            <button type="submit">Upload</button>
          </form>

      <p id="status"></p>

       
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-storage.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAqoKPFBISZV8kJVymXwMi1zqnuXBBfAwI",
            authDomain: "alhadini-f8f97.firebaseapp.com",
            projectId: "alhadini-f8f97",
            storageBucket: "alhadini-f8f97.appspot.com",
            messagingSenderId: "652042838370",
            appId: "1:652042838370:web:151a823b65d111fe3dcc3b",
            measurementId: "G-RY96V379ZZ"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const storage = getStorage(app);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        const signInBtn = document.getElementById("signInBtn");
        const signOutBtn = document.getElementById("signOutBtn");
        const userEmail = document.getElementById("userEmail");
        const form = document.getElementById("productForm");
        const status = document.getElementById("status");

        // Sign in with Google
        signInBtn.addEventListener('click', async () => {
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                alert("Sign in failed: " + error.message);  // Updated line
                console.error(error);
            }
        });


        // Sign out
        signOutBtn.addEventListener('click', () => {
            signOut(auth);
        });

        // Auth state listener
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userEmail.textContent = `Signed in as: ${user.email}`;
                signInBtn.style.display = "none";
                signOutBtn.style.display = "inline";
                form.style.display = "block";
            } else {
                userEmail.textContent = "";
                signInBtn.style.display = "inline";
                signOutBtn.style.display = "none";
                form.style.display = "none";
            }
        });

        // Handle form submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            status.textContent = "Uploading...";

            const name = document.getElementById('name').value;
            const price = document.getElementById('price').value;
            const category = document.getElementById('category').value;
            const file = document.getElementById('image').files[0];

            try {
                // Create a unique filename to prevent overwriting
                const fileName = `${Date.now()}-${file.name}`;
                const storageRef = ref(storage, `products/${fileName}`);

                await uploadBytes(storageRef, file);
                const imageUrl = await getDownloadURL(storageRef);

                await addDoc(collection(db, "products"), {
                    name,
                    // Store price as a number, not a string
                    price: parseFloat(price),
                    category,
                    imageUrl,
                    createdAt: serverTimestamp()
                });

                status.textContent = "✅ Product uploaded successfully!";
                form.reset();
            } catch (error) {
                console.error(error);
                status.textContent = "❌ Upload failed. Check console for error.";
            }
        });
    </script>
</body>

</html>
